<!DOCTYPE html>
<html>

<head>
  <!-- Meta -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">
  <meta name="description"
    content="How to Integrate Paytm Payment Gateway for static hosted Website using Google Cloud Function Quickly. Step by Step Guide.">
  <meta name="author" content="Satyam Gupta #imlolman">
  <link rel="canonical" href="https://imlolman.github.io/blog/" />
  <link rel="shortcut icon" href="https://imlolman.github.io/img/favicon.ico">
  <meta name="robots" content="index, follow">
  <meta property="og:type" content="website" />
  <meta property="og:title" content="imlolman - Satyam Gupta" />
  <meta property="og:description" content="Hi, I am Satyam #imlolman and This is my Blog. I Build Awesome Web Based Projects. I Know Data
    Handeling, Scraping, Automation & Ready to Learn, Build more, because I Love Tech ❤." />
  <meta property="og:image" content="https://imlolman.github.io/blog/img/blog.png" />
  <meta property="og:url" content="https://imlolman.github.io/blog/" />
  <meta property="og:site_name" content="imlolman - Satyam Gupta" />

  <title>Integrate Paytm Payment Gateway for static hosted Website using Google Cloud Function.</title>

  <!-- CSS & fonts -->
  <link rel=" stylesheet" href="/blog/css/main.css">
  <link
    href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,400italic%7CSignika:700,300,400,600'
    rel='stylesheet' type='text/css'>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-142979168-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-142979168-1');
</script>
</head>

<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/blog">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  <a href="https://imlolman.github.io/">Visit My Website</a>
<a href="https://imlolman.github.io/allProjects.html">View My Projects</a>

	</div>
  
  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.1.0</span>

</footer>
	

</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header">
  <a href="/blog">
    <img src="/blog/img/logo-s.png" alt="imlolman's Blog Logo">
    <h1>Satyam's Blog</h1>
  </a>
</header>
      

    <!-- Main content -->
	  <div id="container">
		  
		<main>

			<article id="post-page">
  <h2>Integrate Paytm Payment Gateway for static hosted Website using Google Cloud Function.</h2>
  <time datetime="2019-06-28T00:00:00+05:30" class="by-line">28 Jun 2019</time>
  <div class="content">

    <p>Many a times there is a need for a payment gateway usually for Donation but You have a Static Hosting <em>Ex: github pages</em>. To keep your Merchent key Secret you need to buy hosting, Well <strong>You Don’t Need it Anymore</strong> because you can use <strong>Google Cloud Functions</strong> for free.</p>

<h3 id="what-do-you-need">What Do You Need?</h3>
<ul>
  <li><strong>A Paytm Merchent Account</strong> I’ll use mine for the demo.</li>
  <li><strong>A Google Account</strong> That will be used for using Google Cloud Function.</li>
  <li><strong>A Static Hosting</strong> I’ll use Github Pages for the demo.</li>
</ul>

<h3 id="steps-to-create-backend-using-google-firebase-functions">Steps to Create Backend Using Google Firebase Functions.</h3>
<ol>
  <li>Go to <a href="https://firebase.google.com/">Google Firebase Console</a>.</li>
  <li>Create a New Project.
  <img src="./img/post-images/add-project.png" alt="" /></li>
  <li>Give a name to it, Example paytm-donation.
  <img src="./img/post-images/name-paytm-donation.png" alt="" /></li>
  <li>Go to functions section on the left side.
  <img src="./img/post-images/functions-section.png" alt="" /></li>
  <li>Click on Get Started
  <img src="./img/post-images/get-started-functions.png" alt="" /></li>
  <li>To use Functions, you need to install Firebase command line tools using npm (<a href="https://nodejs.org">Node.js</a>).<br />
If you have node js already installed. Run the following command ti install Latest Version of Firebase CLI.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> firebase-tools
</code></pre></div>    </div>
    <p><img src="./img/post-images/firebase-cli-install.png" alt="" /></p>
  </li>
  <li>After You have everything setup, make a new directory for your project, and move into it.<br />
Initiate your project using:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>firebase init 
</code></pre></div>    </div>
  </li>
  <li>Select Cloud functions using space, select your project, choose javascript as Programing Language and select No for ESLint and Yes for Install Dependancy Now.
  <img src="./img/post-images/firebase-init.png" alt="" /></li>
  <li>Download <a href="https://github.com/Paytm-Payments/Paytm_App_Checksum_Kit_NodeJs/archive/0c2fe4b3c2eefb67018c104bc023c08dcbdfc50b.zip">Zip From Here</a> and Place the <code class="highlighter-rouge">paytm</code> Folder inside <code class="highlighter-rouge">functions</code> folder as Shown.
  <img src="./img/post-images/paytm-folder.png" alt="" /></li>
  <li>Replace the Code for file <code class="highlighter-rouge">paytm_config.js</code> under paytm folder with the following code for better understanding.
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
   <span class="na">paytm_config</span><span class="p">:</span> <span class="p">{</span>
     <span class="na">PAYTM_ENVIRONMENT</span><span class="p">:</span> <span class="dl">'</span><span class="s1">TEST</span><span class="dl">'</span><span class="p">,</span> <span class="c1">//possible values:  TEST | PROD</span>
     <span class="na">MID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">********************</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Get it From https://dashboard.paytm.com/next/apikeys use Test id for test purpose and Production id for Production Purpose</span>
     <span class="na">WEBSITE</span><span class="p">:</span> <span class="dl">'</span><span class="s1">WEBSTAGING</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// USE WEBSTAGING for testing, You Will get it for Production here https://dashboard.paytm.com/next/apikeys</span>
     <span class="na">CHANNEL_ID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">WEB</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Use WEB for Desktop Website and WAP for Mobile Website</span>
     <span class="na">INDUSTRY_TYPE_ID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Retail</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Use Retail for Testing, For Production You Can Get it from here https://dashboard.paytm.com/next/apikeys</span>
     <span class="na">MERCHANT_KEY</span><span class="p">:</span> <span class="dl">'</span><span class="s1">****************</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Get it From https://dashboard.paytm.com/next/apikeys use Test key for test purpose and Production key for Production Purpose</span>
     <span class="na">CALLBACK_URL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://us-central1-*******projectID********.cloudfunctions.net/DonationCallback</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Modify and Use this url for verifying payment, we will use cloud function DonationCallback function for Our usage</span>

     <span class="c1">// Additional Config</span>

     <span class="na">MinAmount</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Munimum amount you waana accept for donation</span>
     <span class="na">PaymentInitURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://myblogurl/donateViaPaytm</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Initial Location where the payment begin</span>
     <span class="na">PaymentSuccessURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://myblogurl/donationSuccessful</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Success Page URL</span>
     <span class="na">PaymentFailureURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://myblogurl/donationFailture</span><span class="dl">'</span> <span class="c1">// Failture page URL</span>

   <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Change the ******* as per your requirements for testing, for Callback url, replace <strong>**</strong><em>projectID</em><strong>**</strong>* with your project ID/ You can find your project id in <a href="https://console.firebase.google.com/u/0/">Firebase Console</a>.</li>
  <li>Make a file named <code class="highlighter-rouge">myFunction.js</code> outside paytm folder as Shown.
  <img src="./img/post-images/myFunction-file-placement.png" alt="" /></li>
  <li>Add the Following Code to it.
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="dl">"</span><span class="s2">use strict</span><span class="dl">"</span><span class="p">;</span>
   <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
     <span class="na">returnPage</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">paramarray</span><span class="p">,</span> <span class="nx">checksum</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
       <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
       <span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">PROD</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://securegw.paytm.in/theia/processTransaction</span><span class="dl">'</span><span class="p">;</span>
       <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">TEST</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://securegw-stage.paytm.in/theia/processTransaction</span><span class="dl">'</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">param</span> <span class="k">in</span> <span class="nx">paramarray</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">field</span> <span class="o">+=</span> <span class="s2">`&lt;input type="hidden" name="`</span> <span class="o">+</span> <span class="nx">param</span> <span class="o">+</span> <span class="s2">`" value="`</span> <span class="o">+</span> <span class="nx">paramarray</span><span class="p">[</span><span class="nx">param</span><span class="p">]</span> <span class="o">+</span> <span class="s2">`"&gt;`</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="s2">`
       &lt;html&gt;
       &lt;head&gt;
         &lt;title&gt;Merchant Check Out Page&lt;/title&gt;
       &lt;/head&gt;
       &lt;body&gt;
         &lt;center&gt;&lt;h1&gt;Please do not refresh this page...&lt;/h1&gt;&lt;/center&gt;
           &lt;form method="post" action="`</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">`" name="f1"&gt;
           &lt;table border="1"&gt;
             &lt;tbody&gt;
             `</span> <span class="o">+</span> <span class="nx">field</span> <span class="o">+</span> <span class="s2">`
             &lt;input type="hidden" name="CHECKSUMHASH" value="`</span> <span class="o">+</span> <span class="nx">checksum</span> <span class="o">+</span> <span class="s2">`"&gt;
             &lt;/tbody&gt;
           &lt;/table&gt;
           &lt;script type="text/javascript"&gt;
             document.f1.submit();
           &lt;/script&gt;
         &lt;/form&gt;
       &lt;/body&gt;
     &lt;/html&gt;`</span><span class="p">;</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Replace the <code class="highlighter-rouge">index.js</code> file code with this code.
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>

 <span class="nx">exports</span><span class="p">.</span><span class="nx">donate</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

   <span class="kd">var</span> <span class="nx">paytm_config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./paytm/paytm_config</span><span class="dl">'</span><span class="p">).</span><span class="nx">paytm_config</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">paytm_checksum</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./paytm/checksum</span><span class="dl">'</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">myFun</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./myFunction</span><span class="dl">'</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;script&gt;window.location = '</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">PaymentInitURL</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'&lt;/script&gt;</span><span class="dl">"</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="kd">var</span> <span class="nx">random</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">999999</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span>
   <span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span>
   <span class="kd">var</span> <span class="nx">mobile</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">mobile</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">orderid</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">orderid</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Amount is Mandatory.</span><span class="dl">'</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&lt;</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">MinAmount</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Minimum Amount of </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">MinAmount</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> is Mandatory.</span><span class="dl">'</span><span class="p">);</span>
     <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">CUST</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">random</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">email</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">email</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">email</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">999999</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">@na.com</span><span class="dl">'</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">mobile</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">mobile</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">9999</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">random</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">orderid</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">orderid</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ORDER</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">random</span>
   <span class="p">}</span>

   <span class="kd">var</span> <span class="nx">paramarray</span> <span class="o">=</span> <span class="p">{};</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">MID</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">MID</span><span class="p">;</span> <span class="c1">//Provided by Paytm</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">ORDER_ID</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">orderid</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">);</span> <span class="c1">//unique OrderId for every request</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">CUST_ID</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// unique customer identifier </span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">INDUSTRY_TYPE_ID</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">INDUSTRY_TYPE_ID</span><span class="p">;</span> <span class="c1">//Provided by Paytm</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">CHANNEL_ID</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">CHANNEL_ID</span><span class="p">;</span> <span class="c1">//Provided by Paytm</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">TXN_AMOUNT</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span> <span class="c1">// transaction amount</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">WEBSITE</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">WEBSITE</span><span class="p">;</span> <span class="c1">//Provided by Paytm</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">CALLBACK_URL</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">CALLBACK_URL</span><span class="p">;</span> <span class="c1">//Provided by Paytm</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">EMAIL</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">email</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// customer email id</span>
   <span class="nx">paramarray</span><span class="p">[</span><span class="dl">'</span><span class="s1">MOBILE_NO</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mobile</span><span class="p">;</span> <span class="c1">// customer 10 digit mobile no.</span>
   <span class="nx">paytm_checksum</span><span class="p">.</span><span class="nx">genchecksum</span><span class="p">(</span><span class="nx">paramarray</span><span class="p">,</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">MERCHANT_KEY</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">checksum</span><span class="p">)</span> <span class="p">{</span>

     <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">myFun</span><span class="p">.</span><span class="nx">returnPage</span><span class="p">(</span><span class="nx">paramarray</span><span class="p">,</span> <span class="nx">checksum</span><span class="p">,</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">PAYTM_ENVIRONMENT</span><span class="p">));</span>
   <span class="p">});</span>
 <span class="p">});</span>

 <span class="nx">exports</span><span class="p">.</span><span class="nx">DonationCallback</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">paytm_config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./paytm/paytm_config</span><span class="dl">'</span><span class="p">).</span><span class="nx">paytm_config</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">paytm_checksum</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./paytm/checksum</span><span class="dl">'</span><span class="p">);</span>

   <span class="kd">var</span> <span class="nx">checksum</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">CHECKSUMHASH</span><span class="p">;</span>
   <span class="k">delete</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">CHECKSUMHASH</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">paytm_checksum</span><span class="p">.</span><span class="nx">verifychecksum</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">MERCHANT_KEY</span><span class="p">,</span> <span class="nx">checksum</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">STATUS</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">TXN_SUCCESS</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;script&gt;window.location = '</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">PaymentSuccessURL</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'&lt;/script&gt;</span><span class="dl">"</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;script&gt;window.location = '</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">PaymentFailureURL</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'&lt;/script&gt;</span><span class="dl">"</span><span class="p">);</span>
     <span class="p">}</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;script&gt;window.location = '</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">paytm_config</span><span class="p">.</span><span class="nx">PaymentFailureURL</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'&lt;/script&gt;</span><span class="dl">"</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">});</span>
</code></pre></div>    </div>
  </li>
  <li>Use Command firebase deploy to deploy the firebase function.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>firebase deploy
</code></pre></div>    </div>
  </li>
</ol>

<p>Your Server is Ready For testing 😃. Lets make some frontend Code.</p>

<h3 id="steps-to-commect-to-your-backend-code-using-your-frontend-code">Steps to Commect to Your Backend Code using Your FrontEnd Code.</h3>
<ol>
  <li>Make a Link to Donation Page from Your Main Page
  <img src="./img/post-images/donate-with-paytm.png" alt="" /></li>
  <li>You will need three files.
    <ol>
      <li><code class="highlighter-rouge">donateViaPaytm.html</code></li>
      <li><code class="highlighter-rouge">donationSuccessful.html</code></li>
      <li><code class="highlighter-rouge">donationFailture.html</code></li>
    </ol>
  </li>
  <li>Make a form in <code class="highlighter-rouge">donateViaPaytm.html</code> with the following fields.
    <ol>
      <li>amount(mandatory)</li>
      <li>name(optional)</li>
      <li>email(optional)</li>
      <li>mobile(optional)</li>
      <li>orderid(optional)</li>
    </ol>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"Post"</span> <span class="na">and</span> <span class="na">action=</span><span class="s">"https://us-central1-*******projectID********.cloudfunctions.net/donate"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"mobile"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">required=</span><span class="s">required</span><span class="nt">&gt;</span>
     <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;/form&gt;</span>
</code></pre></div>    </div>
    <p><img src="./img/post-images/donation-page.png" alt="" /></p>
  </li>
  <li>Submit the form to go to payment gateway.</li>
  <li><code class="highlighter-rouge">donationSuccessful.html</code> Will be Shown in the case of a successful Transaction and <code class="highlighter-rouge">donationFailture.html</code> Will be shown in the case of failed transaction.
  <img src="./img/post-images/donation-successful.png" alt="" />
  <img src="./img/post-images/donation-failture.png" alt="" /></li>
  <li>Do the Testing By Filling Form.</li>
</ol>

<p>Your Payment Gateway is Ready, Change the credentials in the Google Cloud Function’s <code class="highlighter-rouge">paytm_config.js</code> file and You are good to go. 😃</p>

<p>Check it Working on My Main Website <a href="https://imlolman.github.io/">https://imlolman.github.io/</a>, and Test a Donation 😉😉.</p>


  </div>
</article>

	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer class="footer"><span>@2019 - imlolman's Blog | Made with ❤ in India by imLolman</span></footer>

	    <!-- Script -->
      <script src="/blog/js/main.js"></script>



<script src="/blog/js/photoswipe.js"></script>
<script src="/blog/js/photoswipe-dui.js"></script>
<link rel="stylesheet" href="/blog/css/photoswipe.css">
<link rel="stylesheet" href="/blog/css/default-skin/default-skin.css">

<div class=pswp aria-hidden=true role=dialog tabindex=-1>
  <div class=pswp__bg></div>
  <div class=pswp__scroll-wrap>
    <div class=pswp__container>
      <div class=pswp__item></div>
      <div class=pswp__item></div>
      <div class=pswp__item></div>
    </div>
    <div class="pswp__ui pswp__ui--hidden">
      <div class=pswp__top-bar>
        <div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--share" title=Share></button> <button
          class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button
          class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <div class=pswp__preloader>
          <div class=pswp__preloader__icn>
            <div class=pswp__preloader__cut>
              <div class=pswp__preloader__donut></div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class=pswp__share-tooltip></div>
      </div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button
        class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
      <div class=pswp__caption>
        <div class=pswp__caption__center></div>
      </div>
    </div>
  </div>
</div>

<script>
  function runPswp(i = 0) {
    var pswpElement = document.querySelectorAll('.pswp')[0];
    var items = [];
    document.querySelectorAll('#post-page img').forEach(ele => items.push({
      src: ele.src,
      h: ele.naturalHeight,
      w: ele.naturalWidth
    }))
    var options = {
      index: i
    };
    var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
    gallery.init();
  }
  document.querySelectorAll('#post-page img').forEach((ele, i) => ele.setAttribute('onclick', 'runPswp(' + i + ')'))
</script>

	</div>
</body>
</html>
